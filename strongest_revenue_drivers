This SQL code reveals the top countries, cities, customers, films, and genres for film rental company Rockbuster Stealth

/*
TOP COUNTRIES
Identifies countries that generate the most revenue for Rockbuster
*/
SELECT A. country,
COUNT (D.customer_id) AS customer_count
FROM country A
INNER JOIN city B on A. country_id = B. country_id
INNER JOIN address C on C. city_id = B. city_id
INNER JOIN customer D on D. address_id = C. address_id
GROUP BY country
ORDER BY customer_count DESC
LIMIT 10;

/*
TOP CITIES
Identifies highest revenue generating cities within top-earning countries
*/
SELECT A. country,
B. city,
COUNT (D.customer_id) AS customer_count
FROM country A
INNER JOIN city B on A. country_id = B. country_id
INNER JOIN address C on C. city_id = B. city_id
INNER JOIN customer D on D. address_id = C. address_id
WHERE A. country IN(
	SELECT country
	FROM country A
INNER JOIN city B on A. country_id = B. country_id
INNER JOIN address C on C. city_id = B. city_id
INNER JOIN customer D on D. address_id = C. address_id
GROUP BY country
ORDER BY COUNT (D.customer_id) DESC
LIMIT 10
)
GROUP BY A. country, B. city
ORDER BY customer_count DESC
LIMIT 10;

/*
TOP CUSTOMERS
Identifies biggest spenders within highest-earning countries
*/
SELECT D. customer_id,						
D. First_name,						
D. Last_name,						
A. country,						
B. city,						
SUM (E. amount) AS total_paid						
FROM country A						
INNER JOIN city B on A. country_id = B. country_id						
INNER JOIN address C on B. city_id = C. city_id						
INNER JOIN customer D on C. address_id = D. address_id						
INNER JOIN payment E on D. customer_id = E. customer_id						
WHERE B. city IN (						
SELECT						
B. city						
FROM country A						
INNER JOIN city B on A. country_id = B. country_id						
INNER JOIN address C on C. city_id = B. city_id						
INNER JOIN customer D on D. address_id = C. address_id						
WHERE A. country IN(						
		SELECT country				
		FROM country A				
INNER JOIN city B on A. country_id = B. country_id						
INNER JOIN address C on C. city_id = B. city_id						
INNER JOIN customer D on D. address_id = C. address_id						
GROUP BY country						
ORDER BY COUNT (D.customer_id) DESC						
LIMIT 10						
)						
GROUP BY A. country,						
B. city						
ORDER BY COUNT (D. customer_id) DESC						
LIMIT 10						
)						
GROUP BY D. customer_id,						
D. First_name,						
D. Last_name,						
A. country,						
B. city						
ORDER BY SUM (E. amount) DESC						
LIMIT 5;						

/*
TOP GENRES
Identifies film genres that generate the most revenue
*/
SELECT A. name,				
	SUM(E. amount)			
FROM category A				
INNER JOIN film_category B on A. category_id = B. category_id				
INNER JOIN inventory C on B. film_id = C. film_id				
INNER JOIN rental D on C. inventory_id = D. inventory_id				
INNER JOIN payment E on D. rental_id = E. rental_id				
GROUP BY name				
ORDER BY SUM(E. amount) DESC				
LIMIT 10;				

/*
TOP TITLES
Identifies films that generate the most revenue
*/
SELECT A. title,			
	SUM(D. amount)		
FROM film A			
INNER JOIN inventory B on A. film_id = B. film_id			
INNER JOIN rental C on B. inventory_id = C. inventory_id			
INNER JOIN payment D on C. rental_id = D. rental_id			
GROUP BY A. title			
ORDER BY SUM(D. amount) DESC			
LIMIT 10;			

/*
REVENUE BY COUNTRY
Calculates total revenue from each country where Rockbuster has a presence
*/
SELECT country,					
       COUNT(DISTINCT A.customer_id) AS customer_count,					
       SUM(amount) AS total_payment					
FROM customer A					
INNER JOIN address B ON A.address_id = B.address_id					
INNER JOIN city C ON B.city_id = C.city_id					
INNER JOIN country D ON C.country_ID = D.country_ID					
INNER JOIN payment E ON a.customer_id = E.customer_id					
GROUP BY country					
